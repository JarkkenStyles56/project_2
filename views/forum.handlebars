{{> navbar user}}

<div class="container">
    <div class="row">
        <div class="col-md">
            <div class="jumbotron">
                <h4 class="display-6 text-center">Welcome {{user.email}}!</h4>
            </div>
        </div>
    </div>
    <div class="row">
        <div class="col-md">

            <div id="forum-posts">
                {{#each posts}}
                <div class="forum-post-card card text-white bg-primary mb-3">
                    <div class="card-header">
                        <h4 class="text-white"><a href="localhost:8080/articles/{{id}}">{{title}}</a></h4>
                    </div>
                    <img src="{{image}}">
                    <div class="card-body">
                        <p class="card-text">{{body}}</p>
                        by {{'User.email'}}
                        @ {{createdAt}}
                    </div>
                </div>
                {{/each}}
            </div>
        </div>


    </div>

    <div class="row">
        <div class="col-md">
            <form class="forum-post">

                <div class="container mt-4 mb-4">
                    <div class="row justify-content-md-center">
                        <div class="col-md-12 col-lg-8">
                            <h1 class="h2 mb-4">Submit issue</h1>
                            <label>Describe the issue in detail</label>
                            <div class="form-group">
                                <textarea id="editor"></textarea>
                            </div>
                            <button type="submit" class="btn btn-primary">Submit</button>
                        </div>
                    </div>
                </div>

                <fieldset>
                    <legend>Create Your Own Post</legend>
                    <p>
                        Type in your post title and body below, and click submit to send it to our database. We will
                        register it with your email address, and display it above with everyone else's posts!</p>
                    </p>
                    <div class="form-group">
                        <label for="title-input">Title</label>
                        <input type="text" class="form-control" id="title-input" aria-describedby="postHelp"
                            placeholder="Enter your post title">
                        <small id="postHelp" class="form-text text-muted">This'l be shared!</small>
                    </div>
                    <div class="form-group">
                        <label for="image-input">Image URL</label>
                        <input type="text" class="form-control" id="image-input" aria-describedby="postHelp"
                            placeholder="Enter your image url here!">
                        <small id="postHelp" class="form-text text-muted">Make it shiny!</small>
                    </div>
                    <div class="form-group">
                        <label for="body-input">Body</label>
                        <textarea class="form-control" id="body-input" name="body"
                            placeholder="Enter your post body"></textarea>
                    </div>
                    {{!-- <div class="input-group mb-3">
                        <div class="input-group-prepend">
                            <div class="input-group-text">
                                <input type="checkbox" id="isArticle" aria-label="Checkbox for following text input">
                                Article?
                            </div>
                        </div>
                    </div>
                    <div class="input-group mb-3">
                        <div class="input-group-prepend">
                            <div class="input-group-text">
                                <input type="checkbox" id="isReview" aria-label="Checkbox for following text input">
                                Review?
                            </div>
                        </div>
                    </div> --}}
                    <button type="submit" class="btn btn-primary">Post!</button>
                </fieldset>
            </form>
            <br />
        </div>
    </div>
</div>

<script>


    $(document).ready(function () {
        // Getting references to our form and inputs
        const postForm = $("form.forum-post");
        const titleInput = $("input#title-input");
        const imageInput = $("input#image-input");
        const bodyInput = $("textarea#body-input");
        //  const articleInput = $("input#isArticle");
        //  const reviewInput = $("input#isReview");

        // When the form is submitted, we validate there's a title and body entered
        postForm.on("submit", function (event) {
            event.preventDefault();

           // console.log(bodyInput.val(), titleInput.val(), imageInput.val()//, articleInput.val(), reviewInput.val())
            var postData = {
                title: titleInput.val().trim(),
                image: imageInput.val().trim(),
                body: bodyInput.val().trim(),
                //  isArticle: articleInput.val(),
                //  isReview: reviewInput.val()
            };

            if (!postData.title || !postData.image || !postData.body //|| !postData.isArticle || !postData.isReview) {
                return; 
        }


            // If we have a title and password  we run the sendPost function and clear the form
            sendPost(postData.title, postData.image, postData.body//, postData.isArticle, postData.isReview);
            titleInput.val("");
        imageInput.val("");
        bodyInput.val("");
        //    isArticle.val(Boolean);
        //    isReview.val(Boolean);
    });

    // sendPost does a post to our "api/posts" route and if successful, redirects us the the forum page
    function sendPost(title, image, body//, isArticle, isReview) {
            $.post("/api/posts", {
        title: title,
        image: image,
        body: body
        //    isArticle: isArticle,
        //    isReview: isReview
    })
        .then(function () {
            window.location.replace("/forum");
            // If there's an error, log the error
        })
        .catch(function (err) {
            console.log(err);
        });
        }

    });
</script>